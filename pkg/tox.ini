[tox]
requires =
    tox>=4.2
    virtualenv<20.22.0
env_list =
    install
    typecheck

[testenv:install]
description = install package
base_python = python2.7

[testenv:typecheck]
description = run type check on code base
base_python = {[type]base_python}
skip_install = true
deps =
    {[type]deps}
commands =
    mypy src

[testenv:stubgen]
description = generate stubs
base_python = {[type]base_python}
skip_install = true
deps =
    {[type]deps}
commands =
    stubgen --export-less --output=..{/}stubs{/}stubs src

[testenv:style]
description = apply style
base_python = python3.12
skip_install = true
deps =
    black
    flake8==5.0.4
    isort
    pydocstyle
    sort-all
    ssort
    unimport
commands =
    python -c \
      "import pathlib, subprocess; \
      files = [str(p) for p in pathlib.Path('src').rglob('*.py')]; \
      subprocess.run(['sort-all'] + files)"
    ssort src
    black --quiet src
    unimport src
    isort src
    flake8 src
    pydocstyle src

[type]
base_python = python3.12
deps =
    ignition-api-stubs